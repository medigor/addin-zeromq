# addin-zeromq

Внешняя компонента основанная на [ZeroMQ](https://zeromq.org/)

Реализован пока что только паттерн Request-reply:  
https://zeromq.org/socket-api/#request-reply-pattern

## Для чего нужна
1. Для общения между фоновыми заданиями, для эффективной реализации параллельной обработки данных. Предполагается, что задания-воркеры будут получать задания у управляещего задания по мере их выполнения, таким образом реализуется более точное распределение задач между фоновыми заданиями.
2. Для общения 1С с другими сервисами, в т.ч. написанных на других языках.

## Ограничения
Библиотека не использует защищенное соединение, поэтому работа в общественных сетях опасна. Предполагается, что компонента будет использоваться в основном на одном сервере.

## API
Документация в разработке, см. код тестов:
- [ОбщийМодуль.Задания](conf/CommonModules/Задания/Ext/Module.bsl)
- [Обработка.Тесты](conf/DataProcessors/Тесты/Forms/Форма/Ext/Form/Module.bsl)

У всех объектов есть свойство `LastError` типа `Строка`, в нем будет содержаться ошибка в случае исключения при обращении к компоненте.

На данный момент реализовано только 2 объекта: `ZeroMQ.Rep` и `ZeroMQ.Req`

### ZeroMQ.Rep
Сокет `Rep` используется для обработки запросов от клиентов, при получении запроса нужно дать ответ клиенту. Все запросы клиентов выстраиваются в очередь и сервер их обслуживает по очереди.

Методы:
- `Bind(Endpoint: String)` - привязывает сокет к конечной точке и начинает принимать соединения, Это аналогично методу [zmq_bind](https://libzmq.readthedocs.io/en/latest/zmq_bind.html). 
- `Recv(timeout: Число): ДвоичныеДанные|Неопределено` - получает данные от клиента с ожиданием, таймаут задается в миллисекундах. Если таймаут вышел, то вернется Неопределено. Это аналогично последовательному вызову методов: [zmq_poll](https://libzmq.readthedocs.io/en/latest/zmq_poll.html) и [zmq_msg_recv](https://libzmq.readthedocs.io/en/latest/zmq_msg_recv.html)
- `Send(data: ДвоичныеДанные)` - отправляет ответ клиенту, это аналогично [zmq_msg_send](https://libzmq.readthedocs.io/en/latest/zmq_msg_send.html)

### ZeroMQ.Req
Сокет `Req` используется в качестве клиента, после отправки запроса нужно ожидать получения ответа.

Методы:
- `Connect(Endpoint: String)` - выполняет подключение к конечной точке, после подключения можно отправлять запросы. Это аналогично методу [zmq_connect](https://libzmq.readthedocs.io/en/latest/zmq_connect.html). 
- `Disconnect(Endpoint: String)` - привязывает сокет к конечной точке и начинает принимать соединения, Это аналогично методу [zmq_disconnect](https://libzmq.readthedocs.io/en/latest/zmq_disconnect.html).
- `Send(data: ДвоичныеДанные)` - отправляет запрос серверу, это аналогично [zmq_msg_send](https://libzmq.readthedocs.io/en/latest/zmq_msg_send.html)
- `Recv(timeout: Число): ДвоичныеДанные|Неопределено` - получает ответ от сервера с ожиданием, таймаут задается в миллисекундах. Если таймаут вышел, то вернется Неопределено. Это аналогично последовательному вызову методов: [zmq_poll](https://libzmq.readthedocs.io/en/latest/zmq_poll.html) и [zmq_msg_recv](https://libzmq.readthedocs.io/en/latest/zmq_msg_recv.html)
